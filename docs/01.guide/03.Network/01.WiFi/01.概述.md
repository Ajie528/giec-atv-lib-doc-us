---
title: WiFi Overview
date: 2025-4-16 11:38:34
permalink: /pages/net/wifi
---
## Module Introduction

The WiFi module provides comprehensive WiFi management capabilities for Android STB systems. It encapsulates operations for WiFi connectivity, hotspot management, and advanced network configurations, enabling developers to build robust network-enabled applications.

### Key Features

- **WiFi Connection Management**: Enable/disable WiFi, connect to networks, and manage saved configurations
- **Hotspot Operations**: Create and manage WiFi hotspots with various configurations
- **Advanced Network Support**: VLAN, bridge mode, and trunk mode configurations
- **IP Address Management**: Retrieve WiFi IP addresses and network information
- **System Integration**: Built with system-level permissions for comprehensive network control

> Import the package `import com.giec.stb.core.net.wifi.*`

## WifiUtil

The `WifiUtil` object provides essential WiFi connectivity management functions.

### Important Note

::: warning System Behavior
Due to Android system characteristics, WiFi cannot actively connect when the device is connected via Ethernet. However, the WiFi network will show as "Saved." When the Ethernet connection is disconnected, the device will automatically connect to the saved WiFi network.
:::

### API Reference

| Method | Description | Parameters | Return Type |
|--------|-------------|------------|-------------|
| `openWifi(context)` | Enables WiFi | `context: Context` | `Unit` |
| `closeWifi(context)` | Disables WiFi | `context: Context` | `Unit` |
| `disconnectCurrentWifi(context)` | Disconnects from current WiFi | `context: Context` | `Unit` |
| `connectWifi(context, ssid, password)` | Connects to password-protected WiFi | `context: Context, ssid: String, password: String` | `Unit` |
| `connectWifi(context, ssid)` | Connects to open WiFi | `context: Context, ssid: String` | `Unit` |
| `removeWifi(context, ssid)` | Removes saved WiFi configuration | `context: Context, ssid: String` | `Unit` |
| `getWifiIp(context)` | Retrieves current WiFi IP address | `context: Context` | `String` |

### Usage Examples

```kotlin
import com.giec.stb.core.net.wifi.WifiUtil

// Enable WiFi
WifiUtil.openWifi(context)

// Disable WiFi
WifiUtil.closeWifi(context)

// Disconnect from the currently connected WiFi
WifiUtil.disconnectCurrentWifi(context)

// Connect to a password-protected WiFi
WifiUtil.connectWifi(context, "MyWiFiNetwork", "password123")

// Connect to an open WiFi network
WifiUtil.connectWifi(context, "PublicWiFi")

// Remove a saved WiFi network
WifiUtil.removeWifi(context, "OldNetwork")

// Get current WiFi IP address
val wifiIp = WifiUtil.getWifiIp(context)
println("WiFi IP: $wifiIp")
```

### Implementation Details

- Uses `WifiHelp` internal class for WiFi management operations
- Employs callback-based scanning for network discovery
- All operations are logged with the "WifiUtil" tag
- Automatically handles WiFi network discovery and connection processes

---

## WifiHotspotUtil

The `WifiHotspotUtil` object provides comprehensive WiFi hotspot management and advanced network configuration capabilities.

### API Reference

| Method | Description | Parameters | Return Type |
|--------|-------------|------------|-------------|
| `startTethering(context, ssid, password, band, autoShutdownWhenIdle, hidden)` | Starts WiFi hotspot with configuration | See parameter table below | `Boolean` |
| `stopTethering(context)` | Stops WiFi hotspot | `context: Context` | `Boolean` |
| `setAutoShutdownEnabled(context, enable)` | Sets auto shutdown when idle | `context: Context, enable: Boolean` | `Boolean` |
| `clearAllNet()` | Clears all network interfaces except eth0 and wlan0 | None | `Boolean` |
| `setTrunkMode(vlanIface, bridgeIface)` | Sets hotspot to trunk mode | `vlanIface: String, bridgeIface: String` | `Boolean` |
| `setBridgeMode()` | Sets hotspot to bridge mode | None | `Boolean` |
| `setStaModeToStaticIP(ipCidr, gateway, dns1, dns2)` | Sets STA mode to static IP | See parameters below | `Boolean` |
| `setStaModeForToDynamicIP()` | Sets STA mode to dynamic IP | None | `Boolean` |

### Parameter Reference

#### startTethering Parameters
| Parameter | Type | Description | Default |
|-----------|------|-------------|---------|
| `context` | `Context` | Application context | Required |
| `ssid` | `String` | WiFi network name | Required |
| `password` | `String` | WiFi network password | Required |
| `band` | `Int` | Frequency band: 1=2.4GHz, 2=5GHz | `1` |
| `autoShutdownWhenIdle` | `Boolean` | Auto shutdown when no devices connected | `false` |
| `hidden` | `Boolean` | Whether to hide the SSID | `false` |


### Usage Examples

#### Basic Hotspot Operations

```kotlin
import com.giec.stb.core.net.wifi.WifiHotspotUtil

// Start 2.4GHz WiFi hotspot
val result = WifiHotspotUtil.startTethering(
    context = context,
    ssid = "MyHotspot",
    password = "password123",
    band = 1,
    autoShutdownWhenIdle = false,
    hidden = false
)

// Start 5GHz WiFi hotspot with auto shutdown
val result5G = WifiHotspotUtil.startTethering(
    context = context,
    ssid = "MyHotspot5G",
    password = "password123",
    band = 2,
    autoShutdownWhenIdle = true,
    hidden = false
)

// Stop WiFi hotspot
val stopped = WifiHotspotUtil.stopTethering(context)

// Configure auto shutdown setting
val autoShutdownSet = WifiHotspotUtil.setAutoShutdownEnabled(context, true)
```

#### Advanced Network Configuration

```kotlin
// Clear all network interfaces except eth0 and wlan0
val cleared = WifiHotspotUtil.clearAllNet()

// Set up trunk mode with VLAN
val trunkMode = WifiHotspotUtil.setTrunkMode("eth0.100", "br-vlan100")

// Set up bridge mode
val bridgeMode = WifiHotspotUtil.setBridgeMode()
```

### Complete Workflow Example

```kotlin
// Complete workflow for setting up advanced hotspot configuration
class HotspotManager {
    
    fun setupAdvancedHotspot(context: Context) {
        // Step 1: Clear all network interfaces and keep eth0 and wlan0
        if (WifiHotspotUtil.clearAllNet()) {
            Logger.i("HotspotManager", "Network interfaces cleared successfully")
        }
        
        // Step 2: Start WiFi hotspot
        val hotspotStarted = WifiHotspotUtil.startTethering(
            context = context,
            ssid = "GIEC-ATV",
            password = "12345678",
            band = 1,
            autoShutdownWhenIdle = true,
            hidden = false
        )
        
        if (hotspotStarted) {
            Logger.i("HotspotManager", "Hotspot started successfully")
            
            // Step 3: Wait for the AP interface to be created
            Thread.sleep(3000)
            
            // Step 4: Configure trunk mode
            val trunkConfigured = WifiHotspotUtil.setTrunkMode("eth0.100", "br-vlan100")
            if (trunkConfigured) {
                Logger.i("HotspotManager", "Trunk mode configured successfully")
            }
        }
    }
}
```

### Implementation Details

- Employs `SoftApConfiguration` for modern Android versions
- Comprehensive error handling and logging
- Support for multiple tethering interface IDs

### Best Practices

1. **Permission Requirements**: Ensure system-level permissions for hotspot operations
2. **Interface Timing**: Allow time for network interfaces to be created/destroyed
3. **Error Handling**: Check return values for all operations
4. **Network Cleanup**: Use `clearAllNet()` before complex configurations
5. **Testing**: Verify network configurations on target hardware