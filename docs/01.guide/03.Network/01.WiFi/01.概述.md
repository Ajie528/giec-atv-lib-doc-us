---
title: WiFi Overview
date: 2025-4-16 11:38:34
permalink: /pages/net/wifi
---
## Module Introduction

The WiFi module provides comprehensive WiFi management capabilities for Android STB systems. It encapsulates operations for WiFi connectivity, hotspot management, and advanced network configurations, enabling developers to build robust network-enabled applications.

### Key Features

- **WiFi Connection Management**: Enable/disable WiFi, connect to networks, and manage saved configurations
- **Hotspot Operations**: Create and manage WiFi hotspots with various configurations
- **Advanced Network Support**: VLAN, bridge mode, and trunk mode configurations
- **IP Address Management**: Retrieve WiFi IP addresses and network information
- **System Integration**: Built with system-level permissions for comprehensive network control

> Import the package `import com.giec.stb.core.net.wifi.*`

## WifiUtil

The WifiUtil object provides comprehensive WiFi connectivity management with support for multiple security protocols, hidden networks, and automatic connection detection.

### Overview
This utility class simplifies WiFi operations including connecting to networks with various security types, managing connections, and retrieving network information. It supports WEP, WPA-PSK, WPA2-PSK security protocols and includes intelligent auto-detection capabilities.

#### Important Note

::: warning System Limitations

Ethernet Priority: When Ethernet is connected, WiFi cannot actively establish connections but will save network configurations for automatic connection when Ethernet is disconnected

Hidden Networks: Connecting to hidden networks may take longer (up to 10 seconds)
:::

::: tip Best Practices

Use connectWifiAutoDetect() for reliable connections without knowing the exact security type

Always check if WiFi is enabled before attempting connections

Handle connection timeouts gracefully in your UI
:::

### API Reference

#### Core WiFi Management

| Method                           | Description                   | Parameters         | Return Type |
| :------------------------------- | :---------------------------- | :----------------- | :---------- |
| `openWifi(context)`              | Enables WiFi                  | `context: Context` | `Unit`      |
| `closeWifi(context)`             | Disables WiFi                 | `context: Context` | `Unit`      |
| `isWifiEnabled(context)`         | Checks if WiFi is enabled     | `context: Context` | `Boolean`   |
| `disconnectCurrentWifi(context)` | Disconnects from current WiFi | `context: Context` | `Unit`      |
| `forceReconnect(context)`        | Forces WiFi reconnection      | `context: Context` | `Unit`      |

#### Connection Methods

| Method                                                       | Description                          | Parameters                                                   | Return Type |
| :----------------------------------------------------------- | :----------------------------------- | :----------------------------------------------------------- | :---------- |
| `connectWifi(context, ssid)`                                 | Connects to open WiFi                | `context: Context, ssid: String, isHidden: Boolean = false`  | `Boolean`   |
| `connectWifi(context, ssid, password, securityType, isHidden)` | Connects with specific security type | `context: Context, ssid: String, password: String?, securityType: WifiSecurityType, isHidden: Boolean` | `Boolean`   |
| `connectWifiAutoDetect(context, ssid, password, isHidden)`   | Auto-detects security type           | `context: Context, ssid: String, password: String?, isHidden: Boolean` | `Boolean`   |

#### Network Information

| Method                      | Description                   | Parameters         | Return Type |
| :-------------------------- | :---------------------------- | :----------------- | :---------- |
| `getConnectedSsid(context)` | Gets currently connected SSID | `context: Context` | `String`    |
| `getWifiIp(context)`        | Gets current WiFi IP address  | `context: Context` | `String`    |

#### Configuration Management

| Method                      | Description                      | Parameters                       | Return Type |
| :-------------------------- | :------------------------------- | :------------------------------- | :---------- |
| `removeWifi(context, ssid)` | Removes saved WiFi configuration | `context: Context, ssid: String` | `Boolean`   |

### Security Types

The utility supports the following security protocols:


```kotlin
enum class WifiSecurityType {
    OPEN,       // Open network (no password)
    WEP,        // WEP encryption
    WPA_PSK,    // WPA-Personal
    WPA2_PSK,   // WPA2-Personal (most common)
}
```

### Usage Examples

#### Basic Connection


```kotlin
import com.giec.stb.core.net.wifi.WifiUtil

// Enable WiFi first
WifiUtil.openWifi(context)

// Check if WiFi is enabled
if (WifiUtil.isWifiEnabled(context)) {
    // Connect to open WiFi
    val success = WifiUtil.connectWifi(context, "PublicWiFi")
    
    // Connect to password-protected WiFi (auto security detection)
    val success2 = WifiUtil.connectWifiAutoDetect(context, "HomeNetwork", "myPassword")
}
```



#### Advanced Connection with Specific Security


```kotlin
// Connect with specific security type
val success = WifiUtil.connectWifi(
    context = context,
    ssid = "OfficeWiFi",
    password = "office123",
    securityType = WifiSecurityType.WPA2_PSK,
    isHidden = false
)

// Connect to hidden network
val hiddenSuccess = WifiUtil.connectWifi(
    context = context,
    ssid = "HiddenNetwork",
    isHidden = true
)
```



#### Network Information & Management


```kotlin
// Get current connection info
val currentSsid = WifiUtil.getConnectedSsid(context)
val wifiIp = WifiUtil.getWifiIp(context)

println("Connected to: $currentSsid")
println("IP Address: $wifiIp")

// Remove saved network
WifiUtil.removeWifi(context, "OldNetwork")

// Force reconnection if having issues
WifiUtil.forceReconnect(context)
```



#### Connection with Error Handling


```kotlin
fun connectToHomeWiFi() {
    if (!WifiUtil.isWifiEnabled(context)) {
        WifiUtil.openWifi(context)
        // Wait a moment for WiFi to enable
        Thread.sleep(2000)
    }
    
    val success = WifiUtil.connectWifiAutoDetect(
        context = context,
        ssid = "HomeWiFi",
        password = "homePassword",
        isHidden = false
    )
    
    if (success) {
        showMessage("Successfully connected to HomeWiFi")
        val ip = WifiUtil.getWifiIp(context)
        updateConnectionStatus("Connected - IP: $ip")
    } else {
        showMessage("Failed to connect to HomeWiFi")
        // Try alternative method or show troubleshooting options
    }
}
```



### Error Handling

The utility provides detailed logging for troubleshooting:

```kotlin
// Check logs for connection issues:
// - "Failed to add WiFi network" - Configuration error
// - "Connection timeout" - Network not available or wrong password  
// - "Context invalid" - Activity was destroyed during connection
// - "Security type attempts failed" - Auto-detection couldn't connect
```

### Performance Notes

- **Connection Time**: Normal networks ~3-5 seconds, hidden networks ~5-10 seconds
- **Auto-detection**: May take longer as it tries multiple security types sequentially
- **Thread Safety**: All methods are thread-safe and can be called from any thread
- **Lifecycle Awareness**: Automatically handles activity destruction during long operations

This enhanced WiFi utility provides robust connectivity management suitable for most Android applications requiring WiFi functionality.



---

## WifiHotspotUtil

The `WifiHotspotUtil` object provides comprehensive WiFi hotspot management and advanced network configuration capabilities.

### API Reference

| Method | Description | Parameters | Return Type |
|--------|-------------|------------|-------------|
| `startTethering(context, ssid, password, band, autoShutdownWhenIdle, hidden)` | Starts WiFi hotspot with configuration | See parameter table below | `Boolean` |
| `stopTethering(context)` | Stops WiFi hotspot | `context: Context` | `Boolean` |
| `setAutoShutdownEnabled(context, enable)` | Sets auto shutdown when idle | `context: Context, enable: Boolean` | `Boolean` |
| `clearAllNet()` | Clears all network interfaces except eth0 and wlan0 | None | `Boolean` |
| `setTrunkMode(vlanIface, bridgeIface)` | Sets hotspot to trunk mode | `vlanIface: String, bridgeIface: String` | `Boolean` |
| `setBridgeMode()` | Sets hotspot to bridge mode | None | `Boolean` |
| `setStaModeToStaticIP(ipCidr, gateway, dns1, dns2)` | Sets STA mode to static IP | See parameters below | `Boolean` |
| `setStaModeForToDynamicIP()` | Sets STA mode to dynamic IP | None | `Boolean` |
| `getCurrentHotspotSSID(context)` | Get current hotspot SSID | `context: Context` | `String` |
| `getCurrentHotspotPassword(context)` | Get current hotspot password | `context: Context` | `String` |
| `getNetworkConfigInfo()` | Get network configuration information | None | `String` |

### Parameter Reference

#### startTethering Parameters
| Parameter | Type | Description | Default |
|-----------|------|-------------|---------|
| `context` | `Context` | Application context | Required |
| `ssid` | `String` | WiFi network name | Required |
| `password` | `String` | WiFi network password | Required |
| `band` | `Int` | Frequency band: 1=2.4GHz, 2=5GHz | `1` |
| `autoShutdownWhenIdle` | `Boolean` | Auto shutdown when no devices connected | `false` |
| `hidden` | `Boolean` | Whether to hide the SSID | `false` |


### Usage Examples

#### Basic Hotspot Operations

```kotlin
import com.giec.stb.core.net.wifi.WifiHotspotUtil

// Start 2.4GHz WiFi hotspot
val result = WifiHotspotUtil.startTethering(
    context = context,
    ssid = "MyHotspot",
    password = "password123",
    band = 1,
    autoShutdownWhenIdle = false,
    hidden = false
)

// Start 5GHz WiFi hotspot with auto shutdown
val result5G = WifiHotspotUtil.startTethering(
    context = context,
    ssid = "MyHotspot5G",
    password = "password123",
    band = 2,
    autoShutdownWhenIdle = true,
    hidden = false
)

// Stop WiFi hotspot
val stopped = WifiHotspotUtil.stopTethering(context)

// Configure auto shutdown setting
val autoShutdownSet = WifiHotspotUtil.setAutoShutdownEnabled(context, true)
```

#### Advanced Network Configuration

```kotlin
// Clear all network interfaces except eth0 and wlan0
val cleared = WifiHotspotUtil.clearAllNet()

// Set up trunk mode with VLAN
val trunkMode = WifiHotspotUtil.setTrunkMode("eth0.100", "br-vlan100")

// Set up bridge mode
val bridgeMode = WifiHotspotUtil.setBridgeMode()
```

---

#### Get Network Configuration Information

**Output**: JSON string with:
- Current network mode detection (`trunk`, `bridge`, `station`, `nat`, `unknown`)
- Interface details (IP, status, gateway)
- Bridge configuration and members
- Routing table information
- Network reachability tests

**Network Mode Detection Logic**:
1. **NAT Mode**: `ap0` has `192.168.x.x` IP (highest priority)
2. **Trunk Mode**: Bridge interfaces exist + VLAN interfaces exist
3. **Bridge Mode**: Bridge interfaces exist (no VLAN interfaces)
4. **Station Mode**: `eth0` has IP address
5. **Unknown**: None of the above

**Example Output**:
```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "mode": "trunk",
  "interfaces": {
    "eth0": {"ip": null, "status": "UP", "gateway": null},
    "ap0": {"ip": null, "status": "UP", "gateway": null},
    "bridge": {
      "name": "br-vlan100",
      "ip": "10.100.100.32/24",
      "status": "UP",
      "gateway": "10.100.100.1",
      "members": ["eth0.100", "ap0"]
    },
    "vlan": {
      "name": "eth0.100",
      "id": "100",
      "status": "UP"
    }
  },
  "routing": {
    "defaultGateway": "10.40.0.1",
    "mainTableRoutes": 5,
    "legacyNetworkRoutes": 3,
    "localNetworkRoutes": 2
  },
  "networks": {
    "stb": {"network": "10.40.0.0/24", "reachable": true},
    "vlan": {"network": "10.100.100.0/24", "reachable": true},
    "nat": {"network": null, "reachable": false}
  },
  "connectivity": {"internet": true}
}
```



---

### Complete Workflow Example

```kotlin
// Complete workflow for setting up advanced hotspot configuration
class HotspotManager {
    
    fun setupAdvancedHotspot(context: Context) {
        // Step 1: Clear all network interfaces and keep eth0 and wlan0
        if (WifiHotspotUtil.clearAllNet()) {
            Logger.i("HotspotManager", "Network interfaces cleared successfully")
        }
        
        // Step 2: Start WiFi hotspot
        val hotspotStarted = WifiHotspotUtil.startTethering(
            context = context,
            ssid = "GIEC-ATV",
            password = "12345678",
            band = 1,
            autoShutdownWhenIdle = true,
            hidden = false
        )
        
        if (hotspotStarted) {
            Logger.i("HotspotManager", "Hotspot started successfully")
            
            // Step 3: Wait for the AP interface to be created
            Thread.sleep(3000)
            
            // Step 4: Configure trunk mode
            val trunkConfigured = WifiHotspotUtil.setTrunkMode("eth0.100", "br-vlan100")
            if (trunkConfigured) {
                Logger.i("HotspotManager", "Trunk mode configured successfully")
            }
        }
    }
}
```

### Implementation Details

- Employs `SoftApConfiguration` for modern Android versions
- Comprehensive error handling and logging
- Support for multiple tethering interface IDs

### Best Practices

1. **Permission Requirements**: Ensure system-level permissions for hotspot operations
2. **Interface Timing**: Allow time for network interfaces to be created/destroyed
3. **Error Handling**: Check return values for all operations
4. **Network Cleanup**: Use `clearAllNet()` before complex configurations
5. **Testing**: Verify network configurations on target hardware